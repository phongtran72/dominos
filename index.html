<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a5c2a">
  <title>Dominos</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <script>
    // Conditionally load snake board CSS if that style is active
    if ((localStorage.getItem('dominos-boardstyle') || 'snake') === 'snake') {
      document.write('<link rel="stylesheet" href="style-board.css">');
    }
  </script>
  <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
</head>
<body>
  <div id="game-container">

    <!-- Header / Scoreboard -->
    <header id="header">
      <h1 class="logo">Dominos</h1>
      <div class="scores">
        <div class="score-box">
          <span class="score-label">You</span>
          <span id="human-score" class="score-value">0</span>
        </div>
        <div class="score-box">
          <span class="score-label">AI</span>
          <span id="ai-score" class="score-value">0</span>
        </div>
        <div class="score-box hand-box">
          <span class="score-label">Hand</span>
          <span id="hand-number" class="score-value">#1</span>
        </div>
      </div>
    </header>

    <!-- AI Hand -->
    <div id="ai-hand-area">
      <div class="hand-label">AI <span id="ai-tile-count" class="tile-count">(14)</span></div>
      <div id="ai-hand" class="hand-row"></div>
    </div>

    <!-- Status Bar -->
    <div id="status-bar">
      <button id="nav-backward" class="btn btn-nav" style="display:none;" disabled>&laquo;</button>
      <span id="status-message">Welcome</span>
      <button id="nav-forward" class="btn btn-nav" style="display:none;" disabled>&raquo;</button>
      <button id="pass-btn" class="btn btn-pass" style="display:none;">Pass</button>
      <button id="undo-btn" class="btn btn-undo" style="display:none;">Undo</button>
    </div>

    <!-- Eval Bar -->
    <div id="eval-bar-container">
      <span class="eval-side eval-side--you">You</span>
      <div id="eval-bar">
        <div id="eval-fill"></div>
      </div>
      <span class="eval-side eval-side--ai">AI</span>
      <span id="eval-label">Even</span>
    </div>

    <!-- Board -->
    <div id="board-area">
      <div id="board-left-marker" class="end-marker" style="display:none;">
        <span class="end-arrow">&larr;</span>
      </div>
      <div id="board"></div>
      <div id="board-right-marker" class="end-marker" style="display:none;">
        <span class="end-arrow">&rarr;</span>
      </div>
    </div>

    <!-- AI Analysis Panel -->
    <div id="analysis-panel" style="display:none;">
      <div id="analysis-label">AI considered (best â†’ worst):</div>
      <div id="analysis-list"></div>
    </div>

    <!-- Human Hand -->
    <div id="human-hand-area">
      <div class="hand-label">Your Hand <span id="human-tile-count" class="tile-count">(14)</span></div>
      <div id="human-hand" class="hand-row"></div>
    </div>
  </div>

  <!-- Start Screen Overlay -->
  <div id="start-overlay" class="overlay">
    <div class="modal">
      <h2>Dominos</h2>
      <p class="subtitle">Double-Six &bull; First to 100</p>
      <div class="form-group">
        <label>Difficulty</label>
        <div class="radio-group">
          <button class="btn btn-option" data-difficulty="easy">Easy</button>
          <button class="btn btn-option active" data-difficulty="hard">Hard</button>
        </div>
      </div>
      <div class="form-group">
        <label>Engine</label>
        <div class="radio-group">
          <button class="btn btn-option" data-engine="old">Minimax</button>
          <button class="btn btn-option active" data-engine="new">Bitboard</button>
        </div>
      </div>
      <div class="form-group">
        <label>AI Tiles</label>
        <div class="radio-group">
          <button class="btn btn-option" data-opentiles="hidden">Hidden</button>
          <button class="btn btn-option active" data-opentiles="open">Open</button>
        </div>
      </div>
      <div class="form-group">
        <label>Board Style</label>
        <div class="radio-group">
          <button class="btn btn-option" data-boardstyle="classic">Classic</button>
          <button class="btn btn-option" data-boardstyle="snake">Snake</button>
        </div>
      </div>
      <button id="start-btn" class="btn btn-primary">Start Match</button>
      <div id="saved-deals" style="display:none;">
        <div class="form-group" style="margin-top:24px;">
          <label>Saved Games</label>
          <div id="saved-deals-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Leader Choice Overlay -->
  <div id="leader-overlay" class="overlay" style="display:none;">
    <div class="modal">
      <h2>Who Leads?</h2>
      <p class="subtitle">Choose who plays first this hand</p>
      <div class="leader-buttons">
        <button class="btn btn-primary" data-leader="human">I'll Lead</button>
        <button class="btn btn-secondary" data-leader="ai">AI Leads</button>
      </div>
    </div>
  </div>

  <!-- Hand Result Overlay -->
  <div id="result-overlay" class="overlay" style="display:none;">
    <div class="modal">
      <h2 id="result-title">Hand Over</h2>
      <div id="result-body"></div>
      <div class="modal-buttons">
        <button id="review-hand-btn" class="btn btn-secondary">Review Moves</button>
        <button id="next-hand-btn" class="btn btn-primary">Next Hand</button>
      </div>
    </div>
  </div>

  <!-- Match Result Overlay -->
  <div id="match-overlay" class="overlay" style="display:none;">
    <div class="modal">
      <h2 id="match-title">Match Over</h2>
      <div id="match-body"></div>
      <div class="modal-buttons">
        <button id="review-match-btn" class="btn btn-secondary">Review Moves</button>
        <button id="play-again-btn" class="btn btn-primary">Play Again</button>
        <button id="new-game-btn" class="btn btn-secondary">New Game</button>
      </div>
    </div>
  </div>

  <!-- Save Prompt Overlay -->
  <div id="save-overlay" class="overlay" style="display:none;">
    <div class="modal">
      <h2>Save This Game?</h2>
      <p class="subtitle">Save the tile deals to replay this match</p>
      <div id="save-slots"></div>
      <button id="save-skip-btn" class="btn btn-secondary" style="margin-top:16px;">No Thanks</button>
    </div>
  </div>

  <script src="game.js"></script>
  <script src="ai-old.js"></script>
  <script src="ai.js"></script>
  <script>
    // Load the appropriate UI based on board style preference
    (function () {
      var boardStyle = localStorage.getItem('dominos-boardstyle') || 'snake';
      var script = document.createElement('script');
      script.src = (boardStyle === 'snake') ? './ui-board.js' : './ui.js';
      document.body.appendChild(script);
    })();
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
</body>
</html>
